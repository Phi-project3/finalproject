{% extends "base.html" %}

{% block title %}Your Basket - Sustainabite{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='landing_style.css') }}">
<style>
    .basket-container {
        max-width: 900px;
        margin: 40px auto;
        padding: 30px;
        background-color: #fffdf6;
        border-radius: 16px;
        box-shadow: 0 0 12px rgba(0, 0, 0, 0.08);
        font-family: 'Calibri', sans-serif;
    }

    h1 {
        font-size: 2rem;
        margin-bottom: 20px;
        font-family: 'Pacifico', cursive;
        color: #2e7d32;
    }

    .basket-item {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr 1fr 1.5fr;
        gap: 15px;
        padding: 15px 0;
        border-bottom: 1px solid #ddd;
        align-items: center;
        font-size: 1rem;
    }

    .quantity-input {
        width: 60px;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    .action-btn {
        padding: 5px 10px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
    }

    .remove-btn {
        background-color: #e74c3c;
        color: white;
    }

    .update-btn {
        background-color: #27ae60;
        color: white;
        margin-right: 5px;
    }

    .total-line {
        margin-top: 25px;
        font-weight: bold;
        font-size: 1.2rem;
        text-align: right;
    }
</style>
{% endblock %}

{% block content %}
<div class="basket-container">
    <h1>ðŸ§º Your Basket</h1>
    <div id="basket-items"></div>
    <div class="total-line" id="total-carbon">Total Carbon Footprint: 0 kg COâ‚‚e</div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    async function loadBasket() {
        const response = await fetch('/api/basket');
        const data = await response.json();
        const items = data.items;

        const container = document.getElementById('basket-items');
        container.innerHTML = '';

        let totalFootprint = 0;

        items.forEach(item => {
            const subtotal = item.quantity * item.carbonFootprint;
            totalFootprint += subtotal;

            const div = document.createElement('div');
            div.className = 'basket-item';
            div.innerHTML = `
                <div><strong>${item.productName}</strong></div>
                <div>${item.environmentalScore}</div>
                <div>${item.carbonFootprint} kg COâ‚‚e</div>
                <div>
                    <input type="number" class="quantity-input" value="${item.quantity}" min="1" data-barcode="${item.barcode}">
                </div>
                <div>
                    <button class="action-btn update-btn" onclick="updateItem('${item.barcode}')">Update</button>
                    <button class="action-btn remove-btn" onclick="removeItem('${item.barcode}')">Remove</button>
                </div>
            `;
            container.appendChild(div);
        });

        document.getElementById('total-carbon').textContent = `Total Carbon Footprint: ${totalFootprint.toFixed(2)} kg COâ‚‚e`;
    }

    async function updateItem(barcode) {
        const input = document.querySelector(`input[data-barcode="${barcode}"]`);
        const quantity = parseInt(input.value);

        await fetch('/api/basket/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ barcode, quantity })
        });

        loadBasket();
    }

    async function removeItem(barcode) {
        await fetch('/api/basket/remove', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ barcode })
        });

        loadBasket();
    }

    loadBasket();
</script>
{% endblock %}